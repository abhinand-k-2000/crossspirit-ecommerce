<%- include('../layouts/admHeader') %>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.3/xlsx.full.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>








<section class="content-main">
  <div class="content-header">
    <div>
      <h2 class="content-title card-title">Sales Report</h2>
    </div>
   
  </div>
  <div class="card mb-4">
    <header class="card-header">
      <div class="row gx-3">
        <div class="col-lg-4 col-md-6 me-auto">
          <!-- <input type="text" placeholder="Search..." class="form-control" /> -->
        </div>
        <!-- <div class="col-lg-2 col-md-3 col-6">
          <select class="form-select">
            <option>Status</option>
            <option>Active</option>
            <option>Disabled</option>
            <option>Show all</option>
          </select>
        </div> -->
        
        
        <div class="col-lg-4 col-md-6">
          <label for="startDate">Start Date:</label>
          <input type="date" id="startDate" class="form-control" />
        </div>
        
        <div class="col-lg-4 col-md-6">
          <label for="endDate">End Date:</label>
          <input type="date" id="endDate" class="form-control" />
        </div>
        

        <div class="col-lg-2 col-md-3 col-6">
          <select class="form-select"  id="showOption" onchange="toggleTables()">
            <option value="all">Show All</option>
            <option value="daily">Show Daily</option>
            <option value="weekly">Show Weekly</option>
            <option value="yearly">Show Yearly</option>
          </select>
        </div>
      </div>
    </header>
    <!-- card-header end// -->
    <div class="card-body">
      <div class="table-responsive">
        
        <div id="dailyTable" >
            <h4>Daily Report</h4>
            <table id="dailyDataTable" class="table table-hover mt-3">
                <thead>
                <tr>
                    <th></th>
                    <th>#ID</th>
                    <th>Product</th>
                    <th>Quantity</th>
                    <th>Price</th>
                    <th>Payment</th>
                    <th>Date</th>
                    <!-- <th class="text-end">Action</th> -->
                </tr>
                </thead>
                <tbody>
                    <% dailySales.forEach((order, index) => { %>
                        <tr>
                            <td></td>
                            <td><%= index+1%></td>
                            <td><b><%= order.productDetails.name %></b></td>
                            <td><b><%= order.items.quantity %></b></td>
                            <td>Rs. <%=order.items.price * order.items.quantity %></td>
                            <td><%=order.payment %></td>
            
                            <td><%= order.date.toLocaleString() %>
                            </td>
                        </tr>

                    <% }) %>
                

                </tbody>
            </table>
          <div class="text-end">
            <button class="btn btn-dark btn-sm" onclick="exportToExcel('dailyDataTable')">Download Daily Report (Excel)</button>
            <button class="btn btn-dark btn-sm" onclick="exportToPDF('dailyDataTable')">Download Daily Report (PDF)</button>

          </div>

        </div>
        
        <div id="weeklyTable">
            <h4>Weekly Report</h4>
          <table id="weeklyDataTable" class="table table-hover mt-3">
            <thead>
              <tr>
                <th></th>
                <th>#ID</th>
                <th>Product</th>
                <th>Quantity</th>
                <th>Price</th>
                <th>Payment</th>
                <th>Date</th>
                <!-- <th class="text-end">Action</th> -->
              </tr>
            </thead>
            <tbody>

                <% weeklySales.forEach((order, index) => { %>
                    <tr>
                        <td></td>
                        <td><%= index+1%></td>
                        <td><b><%= order.productDetails.name %></b></td>
                        <td><b><%= order.items.quantity %></b></td>
                        <td>Rs. <%=order.items.price * order.items.quantity %></td>
                        <td><%=order.payment %></td>
                        <td><%= order.date.toLocaleString() %>
                        </td>
                      </tr>

                <% }) %>

            </tbody>
          </table>
          <div class="text-end">
            <button class="btn btn-dark btn-sm"  onclick="exportToExcel('weeklyDataTable')">Download Weekly Report</button>
          </div>
        </div>

        <div id="yearlyTable">
            <h4>Yearly Report</h4>
          <table id="yearlyDataTable" class="table table-hover mt-3">
            <thead>
              <tr>
                <th></th>
                <th>#ID</th>
                <th>Product</th>
                <th>Quantity</th>
                <th>Price</th>
                <th>Payment</th>
                <th>Date</th>
                <!-- <th class="text-end">Action</th> -->
              </tr>
            </thead>
            <tbody>

                <% yearlySales.forEach((order, index) => { %>
                    <tr>
                        <td></td>
                        <td><%= index+1%></td>
                        <td><b><%= order.productDetails.name %></b></td>
                        <td><b><%= order.items.quantity %></b></td>
                        <td>Rs. <%=order.items.price * order.items.quantity %></td>
                        <td><%=order.payment %></td>
                        <td><%= order.date.toLocaleString() %>
                        </td>
                      </tr>

                <% }) %>

            </tbody>
          </table>
          <div class="text-end">
            <button class="btn btn-dark btn-sm"  onclick="exportToExcel('yearlyDataTable')">Download Yearly Report</button>
          </div>
        </div>


      </div>
      <!-- table-responsive//end -->
    </div>
    <!-- card-body end// -->
  </div>
  <!-- <div class="pagination-area mt-30 mb-50">
    <nav aria-label="Page navigation example">
      <ul class="pagination justify-content-start">
        <li class="page-item active"><a class="page-link" href="#">01</a></li>
        <li class="page-item"><a class="page-link" href="#">02</a></li>
        <li class="page-item"><a class="page-link" href="#">03</a></li>
        <li class="page-item"><a class="page-link dot" href="#">...</a></li>
        <li class="page-item"><a class="page-link" href="#">16</a></li>
        <li class="page-item">
          <a class="page-link" href="#"
            ><i class="material-icons md-chevron_right"></i
          ></a>
        </li>
      </ul>
    </nav>
  </div> -->
</section>


<script>
    function toggleTables() {
        var showOption = document.getElementById("showOption").value;
        var dailyTable = document.getElementById("dailyTable");
        var weeklyTable = document.getElementById("weeklyTable");
        var yearlyTable = document.getElementById("yearlyTable");

        if (showOption === "all") {
            dailyTable.style.display = "block";
            weeklyTable.style.display = "block";
            yearlyTable.style.display = "block";
        } else if (showOption === "daily") {
            dailyTable.style.display = "block";
            weeklyTable.style.display = "none";
            yearlyTable.style.display = "none";
        } else if (showOption === "weekly") {
            dailyTable.style.display = "none";
            weeklyTable.style.display = "block";
            yearlyTable.style.display = "none";
        } else if (showOption === 'yearly') {
            yearlyTable.style.display = "block";
            dailyTable.style.display = "none";
            weeklyTable.style.display = "none";
        }
    }


    
    function exportToExcel(tableId) {
    const table = document.getElementById(tableId);
    const ws = XLSX.utils.table_to_sheet(table);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "Sheet1");

    let fileName = "";

    switch (tableId) {
        case "dailyDataTable":
            fileName = "Daily_Report.xlsx";
            break;
        case "weeklyDataTable":
            fileName = "Weekly_Report.xlsx";
            break;
        case "yearlyDataTable":
            fileName = "Yearly_Report.xlsx";
            break;
        default:
            fileName = "Report.xlsx";
            break;
    }

    XLSX.writeFile(wb, fileName);
}


</script>

<%- include('../layouts/admFooter') %>


