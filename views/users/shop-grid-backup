<%- include('../layouts/header') %>


		<!--end top header wrapper-->
		<!--start page wrapper -->
		<div class="page-wrapper">
			<div class="page-content">
				<!--start breadcrumb-->
				<section class="py-3 border-bottom border-top d-none d-md-flex bg-light">
					<div class="container">
						<div class="page-breadcrumb d-flex align-items-center">
							<h3 class="breadcrumb-title pe-3">Shop </h3>
							<div class="ms-auto">
								<nav aria-label="breadcrumb">
									<ol class="breadcrumb mb-0 p-0">
										<li class="breadcrumb-item"><a href="javascript:;"><i class="bx bx-home-alt"></i> Home</a>
										</li>
										<li class="breadcrumb-item"><a href="javascript:;">Shop</a>
										</li>
										<li class="breadcrumb-item active" aria-current="page">Shop Left Sidebar</li>
									</ol>
								</nav>
							</div>
						</div>
					</div>
				</section>
				<!--end breadcrumb-->
				<!--start shop area-->
				<section class="py-4">
					<div class="container">
						<div class="btn btn-dark btn-ecomm d-xl-none position-fixed top-50 start-0 translate-middle-y z-index-1"  data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbarFilter"><span><i class='bx bx-filter-alt me-1'></i>Filters</span></div>
						<div class="row">
							<div class="col-12 col-xl-3 filter-column">
								<nav class="navbar navbar-expand-xl flex-wrap p-0">
								  <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasNavbarFilter" aria-labelledby="offcanvasNavbarFilterLabel">
									<div class="offcanvas-header">
									  <h5 class="offcanvas-title mb-0 fw-bold" id="offcanvasNavbarFilterLabel">Filters</h5>
									  <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
									</div>
									<div class="offcanvas-body">
									  <div class="filter-sidebar">
										<div class="card rounded-0 shadow-none border">
										  <div class="card-header d-none d-xl-block bg-transparent">
											  <h5 class="mb-0 fw-bold">Filters</h5>
										  </div>
										  <div class="card-body">
											<h6 class="p-1 fw-bold bg-light">Categories</h6>
											
											<div class="categories">
												<div class="categories-wrapper height-0 p-1">

													<% category.forEach((item) => { %>
														<div class="form-check">
															<input class="form-check-input" type="checkbox" value="<%= item._id %>" id="chekCate<%= item._id %>">
															<label class="form-check-label" for="chekCate<%= item._id %>">
																<span><%= item.name %></span><span class="product-number"></span>
															</label>
														</div>
													<% }) %>												
												</div>
											</div>
											

											<script>

// Function to update the product grid

function updateProductGrid(products) {
  const productGridContainer = document.getElementById('productGrid');

  // Clear existing products
  productGridContainer.innerHTML = '';

  // Iterate through the received products and append them to the grid
  products.forEach(item => {
    const productItem = document.createElement('div');
    productItem.classList.add('col');
    productItem.innerHTML = `
      <div class="card">
        <div class="position-relative overflow-hidden">
          <div class="add-cart position-absolute top-0 end-0 mt-3 me-3">
            <a href="javascript:;"><i class='bx bx-cart-add'></i></a>
          </div>
          <a href="/product-detail/${item._id}">
            <img src="/products/${item.images[0]}" class="img-fluid" alt="...">
          </a>
        </div>
        <div class="card-body px-0">
          <div class="d-flex align-items-center justify-content-between">
            <div>
              <p class="mb-1 product-short-name">Topwear</p>
              <h6 class="mb-0 fw-bold product-short-title">${item.name}</h6>
            </div>
            <div class="icon-wishlist">
              <!-- <a href="javascript:;"><i class="bx bx-heart"></i></a> -->
            </div>
          </div>
          <div class="product-price d-flex align-items-center justify-content-start gap-2 mt-2">
            <div class="h6 fw-light fw-bold text-secondary text-decoration-line-through">${item.price}</div>
            <div class="h6 fw-bold">${item.price}</div>
          </div>
        </div>
      </div>
    `;

    productGridContainer.appendChild(productItem);
  });
}




												document.addEventListener('DOMContentLoaded', function () {
													const checkboxes = document.querySelectorAll('.form-check-input');
											
													checkboxes.forEach((checkbox) => {
														checkbox.addEventListener('change', function () {
															const selectedCategories = Array.from(checkboxes)
																.filter((checkbox) => checkbox.checked)
																.map((checkbox) => checkbox.value);
											
															// Update the query parameters in the URL
															const queryParams = new URLSearchParams(window.location.search);
															queryParams.set('categories', selectedCategories.join(','));
											
															// Replace the current URL without triggering a page reload
															window.history.replaceState({}, '', `${window.location.pathname}?${queryParams}`);
											
															// Trigger the /shop-grid route by making a GET request
															fetch(`/shop-grid/filter?categories=${selectedCategories.join(',')}`)
																.then(response => response.json())
																.then(data => {
																	// Handle the response, e.g., update the product grid
																	console.log('Server Response:', data);
																
																	updateProductGrid(data.products);
																	// TODO: Implement logic to update the product grid based on the response
																})
																.catch(error => console.error('Error:', error));
														});
													});
												});
											</script>
											
											
											
											
											
											<!-- <hr>
											<div class="Price">
											  <h6 class="p-1 fw-bold bg-light">Price</h6>
											   <div class="Price-wrapper p-1">
												<div class="input-group">
												  <input type="text" class="form-control rounded-0" placeholder="$10">
												  <span class="input-group-text bg-section-1 border-0">-</span>
												  <input type="text" class="form-control rounded-0" placeholder="$10000">
												  <button type="button" class="btn btn-outline-dark rounded-0 ms-2"><i class='bx bx-chevron-right me-0'></i></button>
												</div>
											   </div>
											 </div>
											 <hr> -->
											 
											 
											 <hr>
											
										  </div>
										</div>
									  </div>
									</div>
								  </div>
							  </nav>
							</div>
							<div class="col-12 col-xl-9">
								<div class="product-wrapper">
									<!-- <div class="toolbox d-flex align-items-center mb-3 gap-2 border p-3">
										<div class="d-flex flex-wrap flex-grow-1 gap-1">
											<div class="d-flex align-items-center flex-nowrap">
												<p class="mb-0 font-13 text-nowrap">Sort By:</p>
												<select class="form-select ms-3 rounded-0">
													<option value="menu_order" selected="selected">Default sorting</option>
													<option value="popularity">Sort by popularity</option>
													<option value="rating">Sort by average rating</option>
													<option value="date">Sort by newness</option>
													<option value="price">Sort by price: low to high</option>
													<option value="price-desc">Sort by price: high to low</option>
												</select>
											</div>
										</div>
										<div class="d-flex flex-wrap">
											<div class="d-flex align-items-center flex-nowrap">
												<p class="mb-0 font-13 text-nowrap">Show:</p>
												<select class="form-select ms-3 rounded-0">
													<option>9</option>
													<option>12</option>
													<option>16</option>
													<option>20</option>
													<option>50</option>
													<option>100</option>
												</select>
											</div>
										</div>
										<div>	<a href="shop-grid-left-sidebar.html" class="btn btn-white rounded-0"><i class='bx bxs-grid me-0'></i></a>
										</div>
										<div>	<a href="shop-list-left-sidebar.html" class="btn btn-light rounded-0"><i class='bx bx-list-ul me-0'></i></a>
										</div>
									</div> -->

									 <div class="product-grid" >
										<div class="row row-cols-2 row-cols-md-3 row-cols-lg-3 row-cols-xl-3 row-cols-xxl-3 g-3 g-sm-4" id="productGrid">
											
											
											  
											 <!-- <% products.forEach((item) => { %>  -->
												 <div class="col " >
													<div class="card"  >

														<div class="position-relative overflow-hidden">
															<!-- <div class="add-cart position-absolute top-0 end-0 mt-3 me-3">
																<a href="javascript:;"><i class='bx bx-cart-add' ></i></a>
															  </div> -->
														 
														  <a href="/product-detail/<%= item._id %>">
															<img src="/products/<%=item.images[0] %>" class="img-fluid" alt="...">
														  </a>
														</div>
														<div class="card-body px-0">
														  <div class="d-flex align-items-center justify-content-between">
															  <div class="">
																  <p class="mb-1 product-short-name">Topwear</p>
																  <h6 class="mb-0 fw-bold product-short-title"><%= item.name %></h6>
															  </div>
															  <div class="icon-wishlist">
																
															  </div>
														  </div>
													
														  <div class="product-price d-flex align-items-center justify-content-start gap-2 mt-2">
															<div class="h6 fw-light fw-bold text-secondary text-decoration-line-through"><%= item.price %></div>
															<div class="h6 fw-bold">
																
																<% if (item.offer && item.offer.percentage) { %>
																	Rs. <%= calculateDiscountedPrice(item.price, item.offer.percentage) %> <span class="text-success">(<%=item.offer.percentage%>% off)</span>
																  <% } else { %>
																	Rs. <%= item.price %>
																  <% } %>
																
																	<% function calculateDiscountedPrice(originalPrice, discountPercentage) { %>
																		<% const discountAmount = originalPrice * (discountPercentage / 100); %>
																		<% const discountedPrice = originalPrice - discountAmount; %>
																		<% return Math.floor(discountedPrice); %>
																	  <% } %>
															</div>
														  </div>
														</div>							  
												  </div>
												</div> 
											<!-- <% }) %>    -->

											


										</div>
			
									</div> 


									
									
									  


									<hr>
									<!-- <nav class="d-flex justify-content-between" aria-label="Page navigation">
										<ul class="pagination">
											<li class="page-item"><a class="page-link" href="javascript:;"><i class='bx bx-chevron-left'></i> Prev</a>
											</li>
										</ul>
										<ul class="pagination">
											<li class="page-item active d-none d-sm-block" aria-current="page"><span class="page-link">1<span class="visually-hidden">(current)</span></span>
											</li>
											<li class="page-item d-none d-sm-block"><a class="page-link" href="javascript:;">2</a>
											</li>
											<li class="page-item d-none d-sm-block"><a class="page-link" href="javascript:;">3</a>
											</li>
											<li class="page-item d-none d-sm-block"><a class="page-link" href="javascript:;">4</a>
											</li>
											<li class="page-item d-none d-sm-block"><a class="page-link" href="javascript:;">5</a>
											</li>
										</ul>
										<ul class="pagination">
											<li class="page-item"><a class="page-link" href="javascript:;" aria-label="Next">Next <i class='bx bx-chevron-right'></i></a>
											</li>
										</ul>
									</nav> -->

									<nav class="d-flex justify-content-between" aria-label="Page navigation">
										<ul class="pagination">
											<li class="page-item"><a class="page-link" href="?page=<%= currentPage - 1 %>&limit=<%= limit %>"><i class='bx bx-chevron-left'></i> Prev</a></li>
										</ul>
									
										<ul class="pagination">
											<% for (let i = 1; i <= totalPages; i++) { %>
												<li class="page-item <%= i === currentPage ? 'active' : '' %>">
													<a class="page-link" href="?page=<%= i %>&limit=<%= limit %>"><%= i %></a>
												</li>
											<% } %>
										</ul>
									
										<ul class="pagination">
											<li class="page-item"><a class="page-link" href="?page=<%= currentPage + 1 %>&limit=<%= limit %>" aria-label="Next">Next <i class='bx bx-chevron-right'></i></a></li>
										</ul>
									</nav>
									

									<!-- <div class="pagination-area mt-15 mb-50">
										<nav aria-label="Page navigation example">
											<ul class="pagination justify-content-start">
									
												<% for (let i = 1; i <= totalPages; i++) { %>
													<li class="page-item <%= i === currentPage ? 'active' : '' %>">
														<a class="page-link" href="?page=<%= i %>&limit=<%= limit %>"><%= i %></a>
													</li>
												<% } %>
									
												<% if (currentPage < totalPages) { %>
													<li class="page-item">
														<a class="page-link" href="?page=<%= currentPage + 1 %>&limit=<%= limit %>">
															<i class="material-icons md-chevron_right"></i>
														</a>
													</li>
												<% } %>
									
											</ul>
										</nav>
									</div> -->

								</div>
							</div>
						</div>
						<!--end row-->
					</div>
				</section>
				<!--end shop area-->
			</div>
		</div>
		<!--end page wrapper -->
		<!--start footer section-->
	

		
		

		
		<%- include('../layouts/footer') %>